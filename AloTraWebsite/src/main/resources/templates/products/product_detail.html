<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layouts/default_layout :: body(content=~{::content}, additionalJs=~{::additionalJs})}">
<body>
<th:block th:fragment="content">
    <div class="container my-5">
        <div class="row">
            <!-- üñº H√åNH ·∫¢NH -->
            <div class="col-md-5">
                <th:block th:with="primaryImage=${product.media.?[isPrimary == true]}">
                    <img th:if="${!primaryImage.isEmpty()}" th:src="${primaryImage[0].url}" class="img-fluid rounded shadow-sm">
                </th:block>
                <th:block th:if="${product.media.?[isPrimary == true].isEmpty() && !product.media.isEmpty()}">
                    <img th:src="${product.media[0].url}" class="img-fluid rounded shadow-sm">
                </th:block>
                <img th:if="${product.media.isEmpty()}" th:src="@{/images/placeholder.png}" class="img-fluid rounded shadow-sm">
            </div>

            <!-- üßæ TH√îNG TIN -->
            <div class="col-md-7">
                <div class="d-flex justify-content-between align-items-start">
                    <h2 th:text="${product.name}">T√™n s·∫£n ph·∫©m</h2>
                    <button id="wishlist-btn" class="btn btn-outline-danger rounded-circle" style="width:45px;height:45px;">
                        <i id="wishlist-icon" class="fa-regular fa-heart"></i>
                    </button>
                </div>

                <!-- üí∞ GI√Å HI·ªÇN TH·ªä -->
                <div class="my-3">
                    <h3 class="fw-bold text-success mb-0" id="product-price">0 ‚Ç´</h3>
                    <div id="product-original-price" class="text-muted text-decoration-line-through d-none">0 ‚Ç´</div>
                    <div id="product-discount-percent" class="badge bg-danger mt-1 d-none">-0%</div>
                </div>
                <hr>

                <!-- üìè CH·ªåN SIZE -->
                <div class="mb-4">
                    <h5>Ch·ªçn k√≠ch c·ª°</h5>
                    <div class="d-flex gap-2 flex-wrap" id="size-options">
                        <th:block th:each="variant, iterStat : ${sortedVariants}">
                            <button type="button" class="btn btn-outline-primary size-btn p-2"
                                    th:classappend="${iterStat.index == 0} ? 'active' : ''"
                                    th:attr="
                                        data-variant-id=${variant.id},
                                        data-original-price=${variant.originalPrice},
                                        data-discounted-price=${variant.discountedPrice},
                                        data-discount-percent=${variant.discountPercent}
                                    ">
                                <div class="d-flex flex-column text-center" style="min-width: 60px;">
                                    <span class="fw-bold fs-5" th:text="${variant.size.code}">M</span>
                                    <small class="text-muted" th:text="${#numbers.formatDecimal(variant.discountedPrice, 0, 'POINT', 0, 'COMMA')} + ' ‚Ç´'"></small>
                                    <small th:if="${variant.hasDiscount}" class="text-decoration-line-through text-muted"
                                           th:text="${#numbers.formatDecimal(variant.originalPrice, 0, 'POINT', 0, 'COMMA')} + ' ‚Ç´'"></small>
                                </div>
                            </button>
                        </th:block>
                    </div>
                </div>

                <!-- üî¢ S·ªê L∆Ø·ª¢NG -->
                <div class="d-flex align-items-center mb-4">
                    <h5 class="me-3 mb-0">S·ªë l∆∞·ª£ng</h5>
                    <div class="input-group" style="width: 130px;">
                        <button class="btn btn-outline-secondary" type="button" id="btn-minus">‚àí</button>
                        <input type="text" class="form-control text-center" value="1" id="quantity" readonly>
                        <button class="btn btn-outline-secondary" type="button" id="btn-plus">+</button>
                    </div>
                </div>

                <!-- üõí N√öT GI·ªé H√ÄNG -->
                <button class="btn btn-success btn-lg w-100" id="add-to-cart-btn"
                        th:attr="data-product-id=${product.id}">
                    <i class="fas fa-cart-plus me-2"></i>
                    Th√™m v√†o gi·ªè h√†ng - <span id="add-to-cart-price">0 ‚Ç´</span>
                </button>
            </div>
        </div>

        <!-- üìù M√î T·∫¢ -->
<div class="row mt-5">
    <div class="col-12">
        <h4>M√¥ t·∫£ s·∫£n ph·∫©m</h4>
        <p th:text="${product.description}">N·ªôi dung m√¥ t·∫£ s·∫£n ph·∫©m...</p>
    </div>
</div>

<!-- üìù ƒê√ÅNH GI√Å S·∫¢N PH·∫®M -->
<div class="row mt-5">
    <div class="col-12">
        <div class="d-flex align-items-center justify-content-between mb-3">
            <h4>ƒê√°nh gi√° s·∫£n ph·∫©m</h4>
            <div class="d-flex align-items-center">
                <h3 class="mb-0 me-2 text-warning" id="avgRating">0.0</h3>
                <div class="text-muted" id="totalReviews">(0 ƒë√°nh gi√°)</div>
            </div>
        </div>

        <!-- üìã DANH S√ÅCH REVIEW -->
        <div id="reviewList">
            <div class="text-center text-muted py-3">ƒêang t·∫£i ƒë√°nh gi√°...</div>
        </div>

        <!-- üìÑ PH√ÇN TRANG -->
        <nav aria-label="Review pagination" class="mt-4">
            <ul id="reviewPagination" class="pagination justify-content-center"></ul>
        </nav>
    </div>
</div>

    </div>
</th:block>

<th:block th:fragment="additionalJs">
    <script type="module" th:src="@{/js/product-detail.js}" defer></script>

    <style>
        .cart-toast {
            position: fixed;
            right: 120px;
            bottom: 110px;
            background: #198754;
            color: white;
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 14px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.4s ease;
            pointer-events: none;
            z-index: 9999;
        }
        .cart-toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        @keyframes bounce {
            0%   { transform: scale(1); }
            30%  { transform: scale(1.25); }
            60%  { transform: scale(0.9); }
            100% { transform: scale(1); }
        }
        .bounce { animation: bounce 0.4s ease; }
    </style>
</th:block>
</body>
</html>
