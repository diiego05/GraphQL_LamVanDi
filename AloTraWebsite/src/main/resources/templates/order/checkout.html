<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layouts/default_layout :: layout(
          pageTitle='Thanh To√°n',
          content=~{::content},
          additionalJs=~{::additionalJs},
          additionalCss=~{::additionalCss}
      )}">
<head>
    <meta charset="UTF-8">
    <title>Thanh To√°n</title>
    <th:block th:fragment="additionalCss">
        <link rel="stylesheet" th:href="@{/css/checkout.css}">
        <link rel="stylesheet" th:href="@{/css/address-autocomplete.css}">
    </th:block>
</head>
<body>
<th:block th:fragment="content">
    <div class="container my-5">
        <div class="row g-4">

            <!-- üß≠ C·ªôt tr√°i -->
            <div class="col-lg-8">
                <!-- 1Ô∏è‚É£ ƒê·ªãa ch·ªâ giao h√†ng -->
                <div class="card mb-4 shadow-sm">
                    <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                        <strong><i class="fas fa-map-marker-alt me-2"></i> ƒê·ªãa ch·ªâ giao h√†ng</strong>
                        <button class="btn btn-light btn-sm" id="btn-add-address">
                            <i class="fas fa-plus me-1"></i> Th√™m ƒë·ªãa ch·ªâ
                        </button>
                    </div>
                    <div class="card-body" id="address-list">
                        <div class="text-muted">ƒêang t·∫£i ƒë·ªãa ch·ªâ...</div>
                    </div>
                </div>

                <!-- 2Ô∏è‚É£ Chi nh√°nh x·ª≠ l√Ω -->
                <div class="card mb-4 shadow-sm">
                    <div class="card-header bg-success text-white">
                        <strong><i class="fas fa-store me-2"></i> Chi nh√°nh x·ª≠ l√Ω ƒë∆°n h√†ng</strong>
                    </div>
                    <div class="card-body">
                        <select id="branch-select" class="form-select">
                            <option value="">-- Ch·ªçn chi nh√°nh --</option>
                        </select>
                        <div id="branch-warning" class="text-danger mt-2" style="display:none;"></div>
                        <div id="branch-distance" class="text-muted small mt-2" style="display:none;">
                            <i class="fas fa-map-marker-alt"></i> Kho·∫£ng c√°ch: <span id="distance-text"></span>
                        </div>
                    </div>
                </div>

                <!-- 3Ô∏è‚É£ ƒê∆°n v·ªã v·∫≠n chuy·ªÉn -->
                <div class="card mb-4 shadow-sm">
                    <div class="card-header bg-success text-white">
                        <strong><i class="fas fa-truck me-2"></i> ƒê∆°n v·ªã v·∫≠n chuy·ªÉn</strong>
                    </div>
                    <div class="card-body">
                        <select id="carrier-select" class="form-select mb-2">
                            <option value="">-- Ch·ªçn ƒë∆°n v·ªã v·∫≠n chuy·ªÉn --</option>
                        </select>
                        <div class="text-muted">
                            Ph√≠ v·∫≠n chuy·ªÉn: <strong id="shipping-fee">0‚Ç´</strong>
                        </div>
                    </div>
                </div>

                <!-- 4Ô∏è‚É£ M√£ gi·∫£m gi√° -->
                <div class="card mb-4 shadow-sm">
                    <div class="card-header bg-success text-white">
                        <strong><i class="fas fa-ticket-alt me-2"></i> M√£ gi·∫£m gi√°</strong>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <input type="text" class="form-control" id="coupon-code" placeholder="Nh·∫≠p m√£ gi·∫£m gi√°">
                            <button class="btn btn-success" id="apply-coupon-btn">√Åp d·ª•ng</button>
                        </div>
                        <div id="coupon-msg" class="mt-2 text-success small"></div>
                    </div>
                </div>

                <!-- 5Ô∏è‚É£ Ph∆∞∆°ng th·ª©c thanh to√°n -->
                <div class="card mb-4 shadow-sm">
                    <div class="card-header bg-success text-white">
                        <strong><i class="fas fa-credit-card me-2"></i> Ph∆∞∆°ng th·ª©c thanh to√°n</strong>
                    </div>
                    <div class="card-body">
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="radio" name="paymentMethod" value="PICKUP" id="pm-pickup">
                            <label class="form-check-label" for="pm-pickup">
                                <i class="fas fa-store me-1"></i> Nh·∫≠n t·∫°i qu√°n
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="radio" name="paymentMethod" value="COD" id="pm-cod" checked>
                            <label class="form-check-label" for="pm-cod">
                                <i class="fas fa-money-bill-wave me-1"></i> Thanh to√°n khi nh·∫≠n h√†ng
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="radio" name="paymentMethod" value="BANK" id="pm-bank">
                            <label class="form-check-label" for="pm-bank">
                               <i class="fas fa-university me-1"></i> Chuy·ªÉn kho·∫£n ng√¢n h√†ng
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- üßæ C·ªôt ph·∫£i -->
            <div class="col-lg-4">
                <div class="card shadow-sm sticky-top" style="top: 90px;">
                    <div class="card-header bg-success text-white">
                        <strong><i class="fas fa-shopping-cart me-2"></i> T√≥m t·∫Øt ƒë∆°n h√†ng</strong>
                    </div>
                    <div class="card-body">
                        <div id="checkout-item-list" class="mb-3"></div>
                        <hr>
                        <div class="d-flex justify-content-between">
                            <span>T·∫°m t√≠nh</span>
                            <strong id="subtotal">0‚Ç´</strong>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span>Gi·∫£m gi√°</span>
                            <strong id="discount">0‚Ç´</strong>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span>Ph√≠ v·∫≠n chuy·ªÉn</span>
                            <strong id="ship-fee-summary">0‚Ç´</strong>
                        </div>
                        <hr>
                        <div class="d-flex justify-content-between fs-5 mb-3">
                            <span><strong>T·ªïng c·ªông</strong></span>
                            <strong id="grand-total" class="text-success">0‚Ç´</strong>
                        </div>
                        <button class="btn btn-lg btn-success w-100" id="btn-confirm-order">
                            <i class="fas fa-check me-2"></i> X√°c nh·∫≠n ƒë·∫∑t h√†ng
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- üè° Modal Th√™m ƒê·ªãa Ch·ªâ -->
    <div class="modal fade" id="addAddressModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title"><i class="fas fa-map-marker-alt me-2"></i> Th√™m ƒë·ªãa ch·ªâ m·ªõi</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label fw-semibold">Ng∆∞·ªùi nh·∫≠n <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="new-recipient" placeholder="Nh·∫≠p t√™n ng∆∞·ªùi nh·∫≠n">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-semibold">S·ªë ƒëi·ªán tho·∫°i <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="new-phone" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i">
                        </div>
                        <div class="col-12">
                            <label class="form-label fw-semibold">ƒê·ªãa ch·ªâ chi ti·∫øt <span class="text-danger">*</span></label>
                            <div class="address-input-enhanced">
                                <input type="text" class="form-control" id="new-line1"
                                       placeholder="Nh·∫≠p s·ªë nh√†, t√™n ƒë∆∞·ªùng (c√≥ h·ªó tr·ª£ g·ª£i √Ω)">
                                <i class="fas fa-map-marker-alt address-input-icon"></i>
                            </div>
                            <small class="text-muted">
                                <i class="fas fa-info-circle"></i> B·∫Øt ƒë·∫ßu nh·∫≠p ƒë·ªÉ xem g·ª£i √Ω ƒë·ªãa ch·ªâ
                            </small>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-semibold">Ph∆∞·ªùng/X√£</label>
                            <input type="text" class="form-control" id="new-ward" placeholder="Ph∆∞·ªùng/X√£">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-semibold">T·ªânh/Th√†nh ph·ªë</label>
                            <input type="text" class="form-control" id="new-city" placeholder="T·ªânh/Th√†nh ph·ªë">
                        </div>
                        <div class="col-12">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="new-default">
                                <label class="form-check-label" for="new-default">
                                    <i class="fas fa-star text-warning"></i> ƒê·∫∑t l√†m ƒë·ªãa ch·ªâ m·∫∑c ƒë·ªãnh
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i> H·ªßy
                    </button>
                    <button type="button" class="btn btn-success" id="btn-save-address">
                        <i class="fas fa-save me-1"></i> L∆∞u ƒë·ªãa ch·ªâ
                    </button>
                </div>
            </div>
        </div>
    </div>
</th:block>

<th:block th:fragment="additionalJs">
    <script type="module" th:src="@{/js/checkout.js}"></script>
</th:block>
</body>
</html>
