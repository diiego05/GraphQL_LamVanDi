<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
	th:replace="~{layouts/admin-layout :: layout(
        pageTitle='Qu·∫£n l√Ω Ng∆∞·ªùi d√πng',
        pageContent=~{::pageContent},
        additionalJs=~{::additionalJs}
    )}">

<body>
	<div class="page-content" th:fragment="pageContent">
		<!-- ‚úÖ Th√¥ng b√°o -->
		<div th:if="${message}" class="alert alert-success" role="alert"
			th:text="${message}"></div>
		<div th:if="${error}" class="alert alert-danger" role="alert"
			th:text="${error}"></div>

		<div class="card">
			<!-- ‚ùå Kh√¥ng c√≤n n√∫t th√™m m·ªõi -->
			<div
				class="card-header d-flex justify-content-between align-items-center">
				<h5 class="mb-0">Danh s√°ch Ng∆∞·ªùi d√πng</h5>
			</div>

			<div class="card-body">
				<!-- üîç B·ªô l·ªçc -->
				<form th:action="@{/admin/users}" method="get" class="mb-4">
					<div class="row g-3">
						<div class="col-md-5">
							<input type="text" class="form-control" name="keyword"
								th:value="${keyword}" placeholder="T√¨m theo t√™n ho·∫∑c email...">
						</div>
						<div class="col-md-3">
							<select name="roleId" class="form-select">
								<option value="">-- L·ªçc theo vai tr√≤ --</option>
								<option th:each="role : ${roleList}" th:value="${role.id}"
									th:text="${role.name}" th:selected="${role.id == roleId}"></option>
							</select>
						</div>
						<div class="col-md-2">
							<select name="status" class="form-select">
								<option value="">-- L·ªçc theo tr·∫°ng th√°i --</option>
								<option value="ACTIVE" th:selected="${status == 'ACTIVE'}">Ho·∫°t
									ƒë·ªông</option>
								<option value="BANNED" th:selected="${status == 'BANNED'}">B·ªã
									kh√≥a</option>
							</select>
						</div>
						<div class="col-md-2 d-flex">
							<button class="btn btn-primary w-100 me-2" type="submit">L·ªçc</button>
							<a th:href="@{/admin/users}" class="btn btn-outline-secondary">
								<i class="fas fa-sync-alt"></i>
							</a>
						</div>
					</div>
				</form>

				<!-- üßë B·∫£ng danh s√°ch -->
				<table class="table table-striped table-hover">
					<thead>
						<tr>
							<th>H·ªç t√™n</th>
							<th>Email / SƒêT</th>
							<th>Vai tr√≤</th>
							<th>Tr·∫°ng th√°i</th>
							<th>H√†nh ƒë·ªông</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="user : ${userList}">
							<td>
								<div class="d-flex align-items-center">
									<img
										th:src="@{${user.avatarUrl} ?: '/images/avatar-default.jpg'}"
										alt="Avatar" class="rounded-circle me-2" width="40"
										height="40"> <span th:text="${user.fullName}"></span>
								</div>
							</td>
							<td>
								<div th:text="${user.email}"></div> <small class="text-muted"
								th:text="${user.phone}"></small>
							</td>
							<td th:text="${user.role.name}"></td>
							<td><span class="badge"
								th:text="${user.status == 'ACTIVE' ? 'Ho·∫°t ƒë·ªông' : 'B·ªã kh√≥a'}"
								th:classappend="${user.status == 'ACTIVE' ? 'bg-success' : 'bg-danger'}">
							</span></td>
							<td>
								<!-- ‚úÖ Ch·ªâ c√≤n Xem v√† X√≥a --> <a
								th:href="@{/admin/users/details/{id}(id=${user.id})}"
								class="btn btn-success btn-sm">Xem</a> <a
								th:href="@{/admin/users/delete/{id}(id=${user.id})}"
								class="btn btn-danger btn-sm"
								onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a?')">X√≥a</a>
							</td>
						</tr>
						<tr th:if="${#lists.isEmpty(userList)}">
							<td colspan="5" class="text-center">Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi
								d√πng n√†o.</td>
						</tr>
					</tbody>
				</table>
				<!-- üìÑ Ph√¢n trang -->
				<nav aria-label="Page navigation">
					<ul class="pagination justify-content-center mt-3" id="pagination"></ul>
				</nav>
			</div>
		</div>
	</div>

	<!-- ‚úÖ Fragment b·ªï sung JS ƒë·ªÉ tr√°nh l·ªói Thymeleaf -->
	<th:block th:fragment="additionalJs">
		<script>
document.addEventListener("DOMContentLoaded", function() {
    const rowsPerPage = 5;
    const tableBody = document.querySelector("table tbody");
    const rows = Array.from(tableBody.querySelectorAll("tr")).filter(row => !row.querySelector("td[colspan]"));
    const pagination = document.getElementById("pagination");
    const totalRows = rows.length;
    const totalPages = Math.ceil(totalRows / rowsPerPage);
    let currentPage = 1;

    function displayPage(page) {
        const start = (page - 1) * rowsPerPage;
        const end = start + rowsPerPage;
        rows.forEach((row, index) => {
            row.style.display = (index >= start && index < end) ? "" : "none";
        });
    }

    function updatePagination() {
        pagination.innerHTML = "";

        const prevItem = document.createElement("li");
        prevItem.className = "page-item" + (currentPage === 1 ? " disabled" : "");
        prevItem.innerHTML = `<a class="page-link" href="#">&laquo;</a>`;
        prevItem.addEventListener("click", e => {
            e.preventDefault();
            if (currentPage > 1) {
                currentPage--;
                displayPage(currentPage);
                updatePagination();
            }
        });
        pagination.appendChild(prevItem);

        for (let i = 1; i <= totalPages; i++) {
            const pageItem = document.createElement("li");
            pageItem.className = "page-item" + (i === currentPage ? " active" : "");
            pageItem.innerHTML = `<a class="page-link" href="#">${i}</a>`;
            pageItem.addEventListener("click", e => {
                e.preventDefault();
                currentPage = i;
                displayPage(currentPage);
                updatePagination();
            });
            pagination.appendChild(pageItem);
        }

        const nextItem = document.createElement("li");
        nextItem.className = "page-item" + (currentPage === totalPages ? " disabled" : "");
        nextItem.innerHTML = `<a class="page-link" href="#">&raquo;</a>`;
        nextItem.addEventListener("click", e => {
            e.preventDefault();
            if (currentPage < totalPages) {
                currentPage++;
                displayPage(currentPage);
                updatePagination();
            }
        });
        pagination.appendChild(nextItem);
    }

    if (totalRows > 0) {
        displayPage(currentPage);
        updatePagination();
    }
});
</script>
	</th:block>
</body>
</html>
